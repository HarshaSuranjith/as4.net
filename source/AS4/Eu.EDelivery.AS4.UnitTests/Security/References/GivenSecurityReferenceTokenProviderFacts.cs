using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Xml;
using Eu.EDelivery.AS4.Security.References;
using Eu.EDelivery.AS4.UnitTests.Common;
using Xunit;

namespace Eu.EDelivery.AS4.UnitTests.Security.References
{
    public class GivenSecurityReferenceTokenProviderFacts
    {
        public class Signature
        {
            [Fact]
            public void CanRetrieveBinarySecurityTokenFromEnvelope()
            {
                var provider = new SecurityTokenReferenceProvider(new StubCertificateRepository());
                var token = provider.Get(GetBinarySecurityTokenEnvelope(), SecurityTokenType.Signing);

                Assert.NotNull(token);
                Assert.True(token is BinarySecurityTokenReference );
                Assert.NotNull(token.Certificate);
             //   Assert.Equal("#cert-5e2982ff-5edd-4991-8c46-3dd5439e3797", binaryToken.ReferenceId);
            }

            [Fact]
            public void CanRetrieveKeyIdentifierSecurityTokenFromEnvelope()
            {
                var provider = new SecurityTokenReferenceProvider(new StubCertificateRepository());
                var token = provider.Get(GetKeyIdentifierSecurityTokenEnvelope(), SecurityTokenType.Signing);

                Assert.NotNull(token);
                Assert.True(token is KeyIdentifierSecurityTokenReference);
             //   Assert.Equal("#cert-5e2982ff-5edd-4991-8c46-3dd5439e3797", token.ReferenceId);
            }

            [Fact]
            public void CanRetrieveIssuerSecurityTokenFromEnvelope()
            {
                var provider = new SecurityTokenReferenceProvider(new StubCertificateRepository());
                var token = provider.Get(GetIssuerSecurityTokenEnvelope(), SecurityTokenType.Signing);

                Assert.NotNull(token);
                Assert.True(token is IssuerSecurityTokenReference);
            }

            private static XmlDocument GetBinarySecurityTokenEnvelope()
            {
                XmlDocument doc = new XmlDocument();

                doc.LoadXml("<?xml version=\"1.0\" encoding=\"utf-8\"?><s12:Envelope xmlns:s12=\"http://www.w3.org/2003/05/soap-envelope\"><s12:Header><wsse:Security xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"><BinarySecurityToken EncodingType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary\" ValueType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3\" p4:Id=\"cert-037ef435-29a4-4fdd-a323-02b72c268b14\" xmlns:p4=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" xmlns=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\">MIIDPDCCAiSgAwIBAgIIceXaP+xCdFMwDQYJKoZIhvcNAQELBQAwFzEVMBMGA1UEAwwMQWNjZXNzUG9pbnRBMCAXDTE2MTExNTAwMDAwMFoYDzIwNjYxMTE1MDAwMDAwWjAXMRUwEwYDVQQDDAxBY2Nlc3NQb2ludEEwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDEK0bDpKYZn8SVqRE6cFYqBbKUw09a6Ep5NI9gfnQHrTh3ODaBY1DgCIzBR5rPzse3/5tvxYEZXD1BStN8ZYlzAUSgxCvFv25bfAwFpdNSEu5+Mg91EtIfqzT9KCo7Aui2p/gzNwMFJEHtrLaaHdPSG4GiCM04OnTJHKX0j1HLqsH1HCrmtia1MssQhwVUacUtO6Hf/YxMKWbW3m6Is6ZSXUJ52Fi//3mOQOE0+uf6xVsueBTVej0WbhXQ8htmzWkl0WZ9iGQJNzhWQ9ercyh9cJUptfbDRCa6Xn3B9ebCLkIY2dCu/VuMGjrY08LTDzRX5LmjNg3BYrFDzd03EQqzAgMBAAGjgYkwgYYwRgYDVR0jBD8wPYAUVdi1FeoKetwvEYlNqvb9qUPAinuhG6QZMBcxFTATBgNVBAMMDEFjY2Vzc1BvaW50QYIIceXaP+xCdFMwHQYDVR0OBBYEFFXYtRXqCnrcLxGJTar2/alDwIp7MAwGA1UdEwEB/wQCMAAwDwYDVR0lBAgwBgYEVR0lADANBgkqhkiG9w0BAQsFAAOCAQEAvfhIgehE+kU7RznLTsvWZlm/l5u9jbQ2Ks7tQePUVPrw+IvB+bNJ532d5WbZt8iPWKdwXm1YrJv7/t6x/jemRkgGmeOi1/0YftLdZ6PP3d/qGP1bJIClDqf2hCwKBbOmsxlEcz/ErEdt39J7Yvhajex7Ddt8d1RVV4WtmmOTaaZpXt2rquKM+tYMxgM0/jF8xRq6njKBDP9qDt8JJTtUGS+665Y/hqcbxHHogdqq5AZ4KBqkZR6PT8IovBViDNKT5a3Q5lS0wWUMf20aIokX+0F0bMX7k4hJackJZqQkRwcbY6B8XggOfSVSDLqyBXLFqLvkmBb/OpouxOX6RIg7qQ==</BinarySecurityToken><EncryptedKey Id=\"ek-0264a4f3-e4ed-415d-99fb-98277dfef7cb\" xmlns=\"http://www.w3.org/2001/04/xmlenc#\"><EncryptionMethod Algorithm=\"http://www.w3.org/2009/xmlenc11#rsa-oaep\"><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" xmlns=\"http://www.w3.org/2000/09/xmldsig#\" /></EncryptionMethod><KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SecurityTokenReference xmlns=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"><Reference ValueType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3\" URI=\"#cert-037ef435-29a4-4fdd-a323-02b72c268b14\" /></SecurityTokenReference></KeyInfo><CipherData><CipherValue>IiDHH960tjRlaStqOU0rm55RtZb+Sq/ryP7KeGKyuAtzgJ3jVbXkFKXobNgDX9fpc5bK+WwtURey2h/yu3dA44j0BdC5YsqTWCwRMdzjk6wCrovM1kvqUXNmJCTBdlXX6vjt6NuD+AaDU/1kRVdDP10o7lsEHy1y/LCzJft1MeGH3jeG4Dypq48HHt5/ptzI9hykiwIXUGRbvUkDmKnfsEm4rlnY2fagXPctE5eCOILqGgSjzlIWyd+GNmFLpPotAYoDF+xQJ1RM6EQiuIY7Kacd6wQx+D3kyGtKsD0jMZF1CnqslvcSlHebcWYcJGdhftf2mWoqq7Xc8gZYJRS7eg==</CipherValue></CipherData><ReferenceList><DataReference URI=\"#ed-fb1b869f-fc17-4ac0-97bb-2c63743be4d4\" /><DataReference URI=\"#ed-dd4283b9-665e-43db-95a7-ac3418d8b3e3\" /></ReferenceList></EncryptedKey><EncryptedData Id=\"ed-fb1b869f-fc17-4ac0-97bb-2c63743be4d4\" Type=\"http://docs.oasis-open.org/wss/oasis-wss-SwAProfile-1.1#Attachment-Content-Only\" MimeType=\"application/gzip\" xmlns=\"http://www.w3.org/2001/04/xmlenc#\"><EncryptionMethod Algorithm=\"http://www.w3.org/2009/xmlenc11#aes128-gcm\" /><KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SecurityTokenReference xmlns=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"><Reference URI=\"#ek-0264a4f3-e4ed-415d-99fb-98277dfef7cb\" /></SecurityTokenReference></KeyInfo><CipherData><CipherReference URI=\"cid:earth\"><Transforms><Transform Algorithm=\"http://docs.oasis-open.org/wss/oasis-wss-SwAProfile-1.1#Attachment-Ciphertext-Transform\" xmlns=\"http://www.w3.org/2000/09/xmldsig#\" /></Transforms></CipherReference></CipherData></EncryptedData><EncryptedData Id=\"ed-dd4283b9-665e-43db-95a7-ac3418d8b3e3\" Type=\"http://docs.oasis-open.org/wss/oasis-wss-SwAProfile-1.1#Attachment-Content-Only\" MimeType=\"application/gzip\" xmlns=\"http://www.w3.org/2001/04/xmlenc#\"><EncryptionMethod Algorithm=\"http://www.w3.org/2009/xmlenc11#aes128-gcm\" /><KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SecurityTokenReference xmlns=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"><Reference URI=\"#ek-0264a4f3-e4ed-415d-99fb-98277dfef7cb\" /></SecurityTokenReference></KeyInfo><CipherData><CipherReference URI=\"cid:xml-sample\"><Transforms><Transform Algorithm=\"http://docs.oasis-open.org/wss/oasis-wss-SwAProfile-1.1#Attachment-Ciphertext-Transform\" xmlns=\"http://www.w3.org/2000/09/xmldsig#\" /></Transforms></CipherReference></CipherData></EncryptedData><BinarySecurityToken EncodingType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary\" ValueType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3\" p4:Id=\"cert-5e2982ff-5edd-4991-8c46-3dd5439e3797\" xmlns:p4=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" xmlns=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\">MIIDPDCCAiSgAwIBAgIIceXaP+xCdFMwDQYJKoZIhvcNAQELBQAwFzEVMBMGA1UEAwwMQWNjZXNzUG9pbnRBMCAXDTE2MTExNTAwMDAwMFoYDzIwNjYxMTE1MDAwMDAwWjAXMRUwEwYDVQQDDAxBY2Nlc3NQb2ludEEwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDEK0bDpKYZn8SVqRE6cFYqBbKUw09a6Ep5NI9gfnQHrTh3ODaBY1DgCIzBR5rPzse3/5tvxYEZXD1BStN8ZYlzAUSgxCvFv25bfAwFpdNSEu5+Mg91EtIfqzT9KCo7Aui2p/gzNwMFJEHtrLaaHdPSG4GiCM04OnTJHKX0j1HLqsH1HCrmtia1MssQhwVUacUtO6Hf/YxMKWbW3m6Is6ZSXUJ52Fi//3mOQOE0+uf6xVsueBTVej0WbhXQ8htmzWkl0WZ9iGQJNzhWQ9ercyh9cJUptfbDRCa6Xn3B9ebCLkIY2dCu/VuMGjrY08LTDzRX5LmjNg3BYrFDzd03EQqzAgMBAAGjgYkwgYYwRgYDVR0jBD8wPYAUVdi1FeoKetwvEYlNqvb9qUPAinuhG6QZMBcxFTATBgNVBAMMDEFjY2Vzc1BvaW50QYIIceXaP+xCdFMwHQYDVR0OBBYEFFXYtRXqCnrcLxGJTar2/alDwIp7MAwGA1UdEwEB/wQCMAAwDwYDVR0lBAgwBgYEVR0lADANBgkqhkiG9w0BAQsFAAOCAQEAvfhIgehE+kU7RznLTsvWZlm/l5u9jbQ2Ks7tQePUVPrw+IvB+bNJ532d5WbZt8iPWKdwXm1YrJv7/t6x/jemRkgGmeOi1/0YftLdZ6PP3d/qGP1bJIClDqf2hCwKBbOmsxlEcz/ErEdt39J7Yvhajex7Ddt8d1RVV4WtmmOTaaZpXt2rquKM+tYMxgM0/jF8xRq6njKBDP9qDt8JJTtUGS+665Y/hqcbxHHogdqq5AZ4KBqkZR6PT8IovBViDNKT5a3Q5lS0wWUMf20aIokX+0F0bMX7k4hJackJZqQkRwcbY6B8XggOfSVSDLqyBXLFqLvkmBb/OpouxOX6RIg7qQ==</BinarySecurityToken><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /><SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\" /><Reference URI=\"#header-a0c32afa-8a4c-4f00-bdbb-6842c2b54a4f\"><Transforms><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><DigestValue>RmmiOVfauixc2dC4VyRbaq3Ryi7FqUZNHUzwEdFvAYI=</DigestValue></Reference><Reference URI=\"#body-e8070243-ce2c-45a3-a89f-c6d79009c6c1\"><Transforms><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><DigestValue>6lANuBCuxznIcd5Y4MONCbyZ7Q1wzF8Jpq1osVQzjEU=</DigestValue></Reference><Reference URI=\"cid:earth\"><Transforms><Transform Algorithm=\"http://docs.oasis-open.org/wss/oasis-wss-SwAProfile-1.1#Attachment-Content-Signature-Transform\" /></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><DigestValue>L4rIlPJxGTfTbKkiPbBAgCzik9JGVI3Nm3iMTFrBMR4=</DigestValue></Reference><Reference URI=\"cid:xml-sample\"><Transforms><Transform Algorithm=\"http://docs.oasis-open.org/wss/oasis-wss-SwAProfile-1.1#Attachment-Content-Signature-Transform\" /></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><DigestValue>cykTdWiDEb0QNQxuIIQdA0cTWmKi3WgL0MeXYCnDslk=</DigestValue></Reference></SignedInfo><SignatureValue>ijhLhUE4KT1fpLuIVrGcgjlonFzU6HIQoqYPcs7UYC20IE/382ntGcqlPSf7ct6eDQiO8HmBXNX1mulTDUC4BIqjaLh3vhcOpFknEnlBwOHh1b6aKGJcIeD+dsyonCom4TvYSs8e1I3j5D77AqwqJyF8edVLCiVHfjptvzjZnaAF2OpDRzNsuOgBFYBG0YvWYwncS7K46oJmKn3132DfylvZEh1vPB3vMVaUaKLp4jfQPY40SHwdEhfdot58TXa0X6Lfy7ioHboMaXIt0+J5kInbVXvLhNOUXQM7i8KxOWOclz8hBHDhIrx3MgmHyV9RVjSSDwAJzwdFRjb4xijTCQ==</SignatureValue><KeyInfo><SecurityTokenReference xmlns=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"><Reference ValueType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3\" URI=\"#cert-5e2982ff-5edd-4991-8c46-3dd5439e3797\" /></SecurityTokenReference></KeyInfo></Signature></wsse:Security><eb:Messaging xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\" xmlns:s12=\"http://www.w3.org/2003/05/soap-envelope\" wsu:Id=\"header-a0c32afa-8a4c-4f00-bdbb-6842c2b54a4f\" xmlns:eb=\"http://docs.oasis-open.org/ebxml-msg/ebms/v3.0/ns/core/200704/\"><eb:UserMessage mpc=\"http://docs.oasis-open.org/ebxml-msg/ebms/v3.0/ns/core/200704/defaultMPC\"><eb:MessageInfo><eb:Timestamp>2018-02-01T15:20:33.9532203Z</eb:Timestamp><eb:MessageId>f62a57ee-ed4c-4923-8efb-fff46d332ae2@192.168.1.166</eb:MessageId></eb:MessageInfo><eb:PartyInfo><eb:From><eb:PartyId>org:eu:europa:as4:example:accesspoint:A</eb:PartyId><eb:Role>Sender</eb:Role></eb:From><eb:To><eb:PartyId>org:eu:europa:as4:example:accesspoint:B</eb:PartyId><eb:Role>Receiver</eb:Role></eb:To></eb:PartyInfo><eb:CollaborationInfo><eb:AgreementRef pmode=\"03-sample-pmode\">http://agreements.europa.org/agreement</eb:AgreementRef><eb:Service type=\"org:europa:services\">getting:started</eb:Service><eb:Action>eu:sample:03</eb:Action><eb:ConversationId>1</eb:ConversationId></eb:CollaborationInfo><eb:PayloadInfo><eb:PartInfo href=\"cid:earth\"><eb:PartProperties><eb:Property name=\"CompressionType\">application/gzip</eb:Property><eb:Property name=\"MimeType\">image/jpeg</eb:Property></eb:PartProperties></eb:PartInfo><eb:PartInfo href=\"cid:xml-sample\"><eb:PartProperties><eb:Property name=\"CompressionType\">application/gzip</eb:Property><eb:Property name=\"MimeType\">application/xml</eb:Property><eb:Property name=\"Important\">Yes</eb:Property></eb:PartProperties></eb:PartInfo></eb:PayloadInfo></eb:UserMessage></eb:Messaging></s12:Header><s12:Body p2:Id=\"body-e8070243-ce2c-45a3-a89f-c6d79009c6c1\" xmlns:p2=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" /></s12:Envelope>");

                return doc;
            }

            private static XmlDocument GetKeyIdentifierSecurityTokenEnvelope()
            {
                XmlDocument doc = new XmlDocument();

                doc.LoadXml("<?xml version=\"1.0\" encoding=\"utf-8\"?><s12:Envelope xmlns:s12=\"http://www.w3.org/2003/05/soap-envelope\"><s12:Header><wsse:Security xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"><BinarySecurityToken EncodingType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary\" ValueType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3\" p4:Id=\"cert-a86124dd-9305-4a7f-b456-72081df9dd00\" xmlns:p4=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" xmlns=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\">MIIDPDCCAiSgAwIBAgIIceXaP+xCdFMwDQYJKoZIhvcNAQELBQAwFzEVMBMGA1UEAwwMQWNjZXNzUG9pbnRBMCAXDTE2MTExNTAwMDAwMFoYDzIwNjYxMTE1MDAwMDAwWjAXMRUwEwYDVQQDDAxBY2Nlc3NQb2ludEEwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDEK0bDpKYZn8SVqRE6cFYqBbKUw09a6Ep5NI9gfnQHrTh3ODaBY1DgCIzBR5rPzse3/5tvxYEZXD1BStN8ZYlzAUSgxCvFv25bfAwFpdNSEu5+Mg91EtIfqzT9KCo7Aui2p/gzNwMFJEHtrLaaHdPSG4GiCM04OnTJHKX0j1HLqsH1HCrmtia1MssQhwVUacUtO6Hf/YxMKWbW3m6Is6ZSXUJ52Fi//3mOQOE0+uf6xVsueBTVej0WbhXQ8htmzWkl0WZ9iGQJNzhWQ9ercyh9cJUptfbDRCa6Xn3B9ebCLkIY2dCu/VuMGjrY08LTDzRX5LmjNg3BYrFDzd03EQqzAgMBAAGjgYkwgYYwRgYDVR0jBD8wPYAUVdi1FeoKetwvEYlNqvb9qUPAinuhG6QZMBcxFTATBgNVBAMMDEFjY2Vzc1BvaW50QYIIceXaP+xCdFMwHQYDVR0OBBYEFFXYtRXqCnrcLxGJTar2/alDwIp7MAwGA1UdEwEB/wQCMAAwDwYDVR0lBAgwBgYEVR0lADANBgkqhkiG9w0BAQsFAAOCAQEAvfhIgehE+kU7RznLTsvWZlm/l5u9jbQ2Ks7tQePUVPrw+IvB+bNJ532d5WbZt8iPWKdwXm1YrJv7/t6x/jemRkgGmeOi1/0YftLdZ6PP3d/qGP1bJIClDqf2hCwKBbOmsxlEcz/ErEdt39J7Yvhajex7Ddt8d1RVV4WtmmOTaaZpXt2rquKM+tYMxgM0/jF8xRq6njKBDP9qDt8JJTtUGS+665Y/hqcbxHHogdqq5AZ4KBqkZR6PT8IovBViDNKT5a3Q5lS0wWUMf20aIokX+0F0bMX7k4hJackJZqQkRwcbY6B8XggOfSVSDLqyBXLFqLvkmBb/OpouxOX6RIg7qQ==</BinarySecurityToken><EncryptedKey Id=\"ek-9376e071-8171-4069-b0c9-02fa03fc5a24\" xmlns=\"http://www.w3.org/2001/04/xmlenc#\"><EncryptionMethod Algorithm=\"http://www.w3.org/2009/xmlenc11#rsa-oaep\"><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" xmlns=\"http://www.w3.org/2000/09/xmldsig#\" /></EncryptionMethod><KeyInfo p5:Id=\"KI-39c59e27-7597-4b44-bef0-75be40d97b48\" xmlns:p5=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SecurityTokenReference xmlns=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"><Reference ValueType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3\" URI=\"#cert-a86124dd-9305-4a7f-b456-72081df9dd00\" /></SecurityTokenReference></KeyInfo><CipherData><CipherValue>toZiGoYtM0542ZxAe8co0grRx3boGZ8ja2eo0F2Xv/nVce1E0AJw5Rt6KKv8u8gxmM1Pw+j9nZbkxBFbbXvSn/giy2niZPVRTAXGLsNEDr8TxlGxDvdrm5WEY2ClAROoR8EoJWiRb4lmhEoGeuQTx6Cp37SYVuc7hy7KBov4CmiTYggOFF9tqgdAq8xjuZgPDgX20OHjVLkDWTj11lUYUoph6wdS3Z3TuPLoj4P8L4t3jS/xcgHrIopsJiB83hSSveTBtrPc6wyuvPxeKMQdswA9x4X7a4o5BKx/RXp6XRVHwafBgVN1YbNI+Mv1+JWufuXnzo0j+O5g9QN0l7uX2w==</CipherValue></CipherData><ReferenceList><DataReference URI=\"#ed-dc599551-21f6-43de-b166-5a0eefe80f9b\" /><DataReference URI=\"#ed-e1e180a3-d5f0-4f08-9a9a-472bc7acc411\" /></ReferenceList></EncryptedKey><EncryptedData Id=\"ed-dc599551-21f6-43de-b166-5a0eefe80f9b\" Type=\"http://docs.oasis-open.org/wss/oasis-wss-SwAProfile-1.1#Attachment-Content-Only\" MimeType=\"application/gzip\" xmlns=\"http://www.w3.org/2001/04/xmlenc#\"><EncryptionMethod Algorithm=\"http://www.w3.org/2009/xmlenc11#aes128-gcm\" /><KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SecurityTokenReference xmlns=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"><Reference URI=\"#ek-9376e071-8171-4069-b0c9-02fa03fc5a24\" /></SecurityTokenReference></KeyInfo><CipherData><CipherReference URI=\"cid:earth\"><Transforms><Transform Algorithm=\"http://docs.oasis-open.org/wss/oasis-wss-SwAProfile-1.1#Attachment-Ciphertext-Transform\" xmlns=\"http://www.w3.org/2000/09/xmldsig#\" /></Transforms></CipherReference></CipherData></EncryptedData><EncryptedData Id=\"ed-e1e180a3-d5f0-4f08-9a9a-472bc7acc411\" Type=\"http://docs.oasis-open.org/wss/oasis-wss-SwAProfile-1.1#Attachment-Content-Only\" MimeType=\"application/gzip\" xmlns=\"http://www.w3.org/2001/04/xmlenc#\"><EncryptionMethod Algorithm=\"http://www.w3.org/2009/xmlenc11#aes128-gcm\" /><KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SecurityTokenReference xmlns=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"><Reference URI=\"#ek-9376e071-8171-4069-b0c9-02fa03fc5a24\" /></SecurityTokenReference></KeyInfo><CipherData><CipherReference URI=\"cid:xml-sample\"><Transforms><Transform Algorithm=\"http://docs.oasis-open.org/wss/oasis-wss-SwAProfile-1.1#Attachment-Ciphertext-Transform\" xmlns=\"http://www.w3.org/2000/09/xmldsig#\" /></Transforms></CipherReference></CipherData></EncryptedData><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /><SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\" /><Reference URI=\"#header-051a851e-94c4-444e-839d-97206ab083b2\"><Transforms><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><DigestValue>xuaE9bKSRzbH6v3nkdzjKVMbKdOYC/Mph5M2XYBYOkQ=</DigestValue></Reference><Reference URI=\"#body-b2a5bd63-380a-4e9b-9d64-541b7290abcd\"><Transforms><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><DigestValue>0A2dIfICgLdmTwrDyD3R4Z1GRZ6s/pwNNA6Q3idP0t4=</DigestValue></Reference><Reference URI=\"cid:earth\"><Transforms><Transform Algorithm=\"http://docs.oasis-open.org/wss/oasis-wss-SwAProfile-1.1#Attachment-Content-Signature-Transform\" /></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><DigestValue>L4rIlPJxGTfTbKkiPbBAgCzik9JGVI3Nm3iMTFrBMR4=</DigestValue></Reference><Reference URI=\"cid:xml-sample\"><Transforms><Transform Algorithm=\"http://docs.oasis-open.org/wss/oasis-wss-SwAProfile-1.1#Attachment-Content-Signature-Transform\" /></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><DigestValue>cykTdWiDEb0QNQxuIIQdA0cTWmKi3WgL0MeXYCnDslk=</DigestValue></Reference></SignedInfo><SignatureValue>nz1KEL4+uyMA803SkBDFXtpKXUMiY7mnaYqPq3D6M1yPRZIiVNXQoQ24JAEhs5wVDnuLkMXvPepcjWME1Ts7viyjh7WLlrysu9xdE70JdbjS/76TIBt0ZDP0hWmDXyMK7aI0cb8VYGeBULf6mYuj2NPO8wr1y+R54+u3pdchb90omRUpNxUPzjgUbuezH8UqqelZf8ucllWcrKtjafQV88L5gekXYkqfgVFXmQ41VrGb3/39SALb9uuD5MWWFVc6vL0EdKwTTItrihDf49pLA5s8eyWcLDLDvCPqG4e1G6+/UtUeFgb/BlNKggBbfZXp5KbyfUW59NfN4H3783uT8g==</SignatureValue><KeyInfo><wsse:SecurityTokenReference><wsse:KeyIdentifier EncodingType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary\" ValueType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509SubjectKeyIdentifier\">Vdi1FeoKetwvEYlNqvb9qUPAins=</wsse:KeyIdentifier></wsse:SecurityTokenReference></KeyInfo></Signature></wsse:Security><eb:Messaging xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\" xmlns:s12=\"http://www.w3.org/2003/05/soap-envelope\" wsu:Id=\"header-051a851e-94c4-444e-839d-97206ab083b2\" xmlns:eb=\"http://docs.oasis-open.org/ebxml-msg/ebms/v3.0/ns/core/200704/\"><eb:UserMessage mpc=\"http://docs.oasis-open.org/ebxml-msg/ebms/v3.0/ns/core/200704/defaultMPC\"><eb:MessageInfo><eb:Timestamp>2018-02-01T17:08:09.2049367Z</eb:Timestamp><eb:MessageId>e6d31dbf-733e-46ee-96c5-7936061c1df7@192.168.1.166</eb:MessageId></eb:MessageInfo><eb:PartyInfo><eb:From><eb:PartyId>org:eu:europa:as4:example:accesspoint:A</eb:PartyId><eb:Role>Sender</eb:Role></eb:From><eb:To><eb:PartyId>org:eu:europa:as4:example:accesspoint:B</eb:PartyId><eb:Role>Receiver</eb:Role></eb:To></eb:PartyInfo><eb:CollaborationInfo><eb:AgreementRef pmode=\"03-sample-pmode\">http://agreements.europa.org/agreement</eb:AgreementRef><eb:Service type=\"org:europa:services\">getting:started</eb:Service><eb:Action>eu:sample:03</eb:Action><eb:ConversationId>1</eb:ConversationId></eb:CollaborationInfo><eb:PayloadInfo><eb:PartInfo href=\"cid:earth\"><eb:PartProperties><eb:Property name=\"CompressionType\">application/gzip</eb:Property><eb:Property name=\"MimeType\">image/jpeg</eb:Property></eb:PartProperties></eb:PartInfo><eb:PartInfo href=\"cid:xml-sample\"><eb:PartProperties><eb:Property name=\"CompressionType\">application/gzip</eb:Property><eb:Property name=\"MimeType\">application/xml</eb:Property><eb:Property name=\"Important\">Yes</eb:Property></eb:PartProperties></eb:PartInfo></eb:PayloadInfo></eb:UserMessage></eb:Messaging></s12:Header><s12:Body p2:Id=\"body-b2a5bd63-380a-4e9b-9d64-541b7290abcd\" xmlns:p2=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" /></s12:Envelope>");

                return doc;
            }

            private static XmlDocument GetIssuerSecurityTokenEnvelope()
            {
                XmlDocument doc = new XmlDocument();

                doc.LoadXml("<?xml version=\"1.0\" encoding=\"utf-8\"?><s12:Envelope xmlns:s12=\"http://www.w3.org/2003/05/soap-envelope\"><s12:Header><wsse:Security xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"><BinarySecurityToken EncodingType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary\" ValueType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3\" p4:Id=\"cert-6ea70587-4901-4a78-a66e-666178026471\" xmlns:p4=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" xmlns=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\">MIIDPDCCAiSgAwIBAgIIceXaP+xCdFMwDQYJKoZIhvcNAQELBQAwFzEVMBMGA1UEAwwMQWNjZXNzUG9pbnRBMCAXDTE2MTExNTAwMDAwMFoYDzIwNjYxMTE1MDAwMDAwWjAXMRUwEwYDVQQDDAxBY2Nlc3NQb2ludEEwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDEK0bDpKYZn8SVqRE6cFYqBbKUw09a6Ep5NI9gfnQHrTh3ODaBY1DgCIzBR5rPzse3/5tvxYEZXD1BStN8ZYlzAUSgxCvFv25bfAwFpdNSEu5+Mg91EtIfqzT9KCo7Aui2p/gzNwMFJEHtrLaaHdPSG4GiCM04OnTJHKX0j1HLqsH1HCrmtia1MssQhwVUacUtO6Hf/YxMKWbW3m6Is6ZSXUJ52Fi//3mOQOE0+uf6xVsueBTVej0WbhXQ8htmzWkl0WZ9iGQJNzhWQ9ercyh9cJUptfbDRCa6Xn3B9ebCLkIY2dCu/VuMGjrY08LTDzRX5LmjNg3BYrFDzd03EQqzAgMBAAGjgYkwgYYwRgYDVR0jBD8wPYAUVdi1FeoKetwvEYlNqvb9qUPAinuhG6QZMBcxFTATBgNVBAMMDEFjY2Vzc1BvaW50QYIIceXaP+xCdFMwHQYDVR0OBBYEFFXYtRXqCnrcLxGJTar2/alDwIp7MAwGA1UdEwEB/wQCMAAwDwYDVR0lBAgwBgYEVR0lADANBgkqhkiG9w0BAQsFAAOCAQEAvfhIgehE+kU7RznLTsvWZlm/l5u9jbQ2Ks7tQePUVPrw+IvB+bNJ532d5WbZt8iPWKdwXm1YrJv7/t6x/jemRkgGmeOi1/0YftLdZ6PP3d/qGP1bJIClDqf2hCwKBbOmsxlEcz/ErEdt39J7Yvhajex7Ddt8d1RVV4WtmmOTaaZpXt2rquKM+tYMxgM0/jF8xRq6njKBDP9qDt8JJTtUGS+665Y/hqcbxHHogdqq5AZ4KBqkZR6PT8IovBViDNKT5a3Q5lS0wWUMf20aIokX+0F0bMX7k4hJackJZqQkRwcbY6B8XggOfSVSDLqyBXLFqLvkmBb/OpouxOX6RIg7qQ==</BinarySecurityToken><EncryptedKey Id=\"ek-1586073b-ca32-4875-b2c1-4bb7fb8fa822\" xmlns=\"http://www.w3.org/2001/04/xmlenc#\"><EncryptionMethod Algorithm=\"http://www.w3.org/2009/xmlenc11#rsa-oaep\"><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" xmlns=\"http://www.w3.org/2000/09/xmldsig#\" /></EncryptionMethod><KeyInfo p5:Id=\"KI-bc2fd5bc-382a-49c4-8868-b1a54aa25f8c\" xmlns:p5=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SecurityTokenReference xmlns=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"><Reference ValueType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3\" URI=\"#cert-6ea70587-4901-4a78-a66e-666178026471\" /></SecurityTokenReference></KeyInfo><CipherData><CipherValue>Qy9pQ0u/kFN+W8QN4whw+q3Htc6EBuzIUGWtXfNQbtC4Ia3qoCaWi4lVx53eFAvOtNNCqlks7pcWG0CWhImIgY1rv8CXyaU7MrS+Wfemvivyh254I8r2C04FGKKI+ljlEnIYAYiwGbQ7OEXoODgWipdUmN0/sqGM372ZMlkSuV5JUJr1V0rMcxJJVecDr3jzxz6/p5DAM/9DLOd46uu65wOesmMGOv0p30z5TNgkUoX87R9lCZRgNnLKP8kVXtWS0fK5ZuGWMG8S99yFNPoFDruqiBk8rwbu04No5+svcoDl95Ac8lP8i9TZUpKbkANwRxOWTfMs8+93UqvnEEFvcg==</CipherValue></CipherData><ReferenceList><DataReference URI=\"#ed-ae827c1f-d334-4939-9657-b050f97bbc31\" /><DataReference URI=\"#ed-b99d1164-f8b0-4a71-a11b-6b72e386dd16\" /></ReferenceList></EncryptedKey><EncryptedData Id=\"ed-ae827c1f-d334-4939-9657-b050f97bbc31\" Type=\"http://docs.oasis-open.org/wss/oasis-wss-SwAProfile-1.1#Attachment-Content-Only\" MimeType=\"application/gzip\" xmlns=\"http://www.w3.org/2001/04/xmlenc#\"><EncryptionMethod Algorithm=\"http://www.w3.org/2009/xmlenc11#aes128-gcm\" /><KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SecurityTokenReference xmlns=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"><Reference URI=\"#ek-1586073b-ca32-4875-b2c1-4bb7fb8fa822\" /></SecurityTokenReference></KeyInfo><CipherData><CipherReference URI=\"cid:earth\"><Transforms><Transform Algorithm=\"http://docs.oasis-open.org/wss/oasis-wss-SwAProfile-1.1#Attachment-Ciphertext-Transform\" xmlns=\"http://www.w3.org/2000/09/xmldsig#\" /></Transforms></CipherReference></CipherData></EncryptedData><EncryptedData Id=\"ed-b99d1164-f8b0-4a71-a11b-6b72e386dd16\" Type=\"http://docs.oasis-open.org/wss/oasis-wss-SwAProfile-1.1#Attachment-Content-Only\" MimeType=\"application/gzip\" xmlns=\"http://www.w3.org/2001/04/xmlenc#\"><EncryptionMethod Algorithm=\"http://www.w3.org/2009/xmlenc11#aes128-gcm\" /><KeyInfo xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SecurityTokenReference xmlns=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"><Reference URI=\"#ek-1586073b-ca32-4875-b2c1-4bb7fb8fa822\" /></SecurityTokenReference></KeyInfo><CipherData><CipherReference URI=\"cid:xml-sample\"><Transforms><Transform Algorithm=\"http://docs.oasis-open.org/wss/oasis-wss-SwAProfile-1.1#Attachment-Ciphertext-Transform\" xmlns=\"http://www.w3.org/2000/09/xmldsig#\" /></Transforms></CipherReference></CipherData></EncryptedData><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /><SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\" /><Reference URI=\"#header-30bb4cac-b428-4ae3-9998-588c4e429234\"><Transforms><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><DigestValue>BVQY+InCCmd4l6bFM+pWqcy8UfqMFexzFFDmLwqtbjc=</DigestValue></Reference><Reference URI=\"#body-419d62e8-ea24-4c05-a40b-7a0169065b46\"><Transforms><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><DigestValue>lKwK/z/DzQl+D8JsYwtnPb3gVfNgR/uUtzRtpN+zwAs=</DigestValue></Reference><Reference URI=\"cid:earth\"><Transforms><Transform Algorithm=\"http://docs.oasis-open.org/wss/oasis-wss-SwAProfile-1.1#Attachment-Content-Signature-Transform\" /></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><DigestValue>L4rIlPJxGTfTbKkiPbBAgCzik9JGVI3Nm3iMTFrBMR4=</DigestValue></Reference><Reference URI=\"cid:xml-sample\"><Transforms><Transform Algorithm=\"http://docs.oasis-open.org/wss/oasis-wss-SwAProfile-1.1#Attachment-Content-Signature-Transform\" /></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><DigestValue>cykTdWiDEb0QNQxuIIQdA0cTWmKi3WgL0MeXYCnDslk=</DigestValue></Reference></SignedInfo><SignatureValue>jD0Oy6a7D748HQut7issXr1q8lPvf8zs4zWBTFd9PLBelHJXazBrRHKC7Nnl5xstG/tPRMd4bIG6NznsoyegDDNJeijEdcqs3fY2OhCFN1cNihj1PIiOD4i8erekmJjRKMwIyKBXF6pj6Un8s8CWZ+mCc28+dxt8vWFTQ6mqovO1YX+4bcvoxvoX7Chjub5gfyw6ikSism82PjDQ3JKRnQjwpx8eTzHco4AMDQeQc/5hKxbKxfE2KV+k7DSRt2LS3ggnRK7t2i5CHJp0WVRHwL/Op73Udozp5ZqwroidR8YP9mN4nHzhmMVSZpejEyJeniQutZOXs5/xw5HeMHCXVA==</SignatureValue><KeyInfo><wsse:SecurityTokenReference p6:Id=\"STR-621396ae-900d-4371-9c3d-0425f43613d0\" xmlns:p6=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"><ds:X509Data xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"><ds:X509IssuerSerial><ds:X509IssuerName>CN=AccessPointA</ds:X509IssuerName><ds:X509SerialNumber>8207205864034169939</ds:X509SerialNumber></ds:X509IssuerSerial></ds:X509Data></wsse:SecurityTokenReference></KeyInfo></Signature></wsse:Security><eb:Messaging xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\" xmlns:s12=\"http://www.w3.org/2003/05/soap-envelope\" wsu:Id=\"header-30bb4cac-b428-4ae3-9998-588c4e429234\" xmlns:eb=\"http://docs.oasis-open.org/ebxml-msg/ebms/v3.0/ns/core/200704/\"><eb:UserMessage mpc=\"http://docs.oasis-open.org/ebxml-msg/ebms/v3.0/ns/core/200704/defaultMPC\"><eb:MessageInfo><eb:Timestamp>2018-02-01T17:02:03.6910928Z</eb:Timestamp><eb:MessageId>068821c8-b07f-41a4-9312-65911512fc29@192.168.1.166</eb:MessageId></eb:MessageInfo><eb:PartyInfo><eb:From><eb:PartyId>org:eu:europa:as4:example:accesspoint:A</eb:PartyId><eb:Role>Sender</eb:Role></eb:From><eb:To><eb:PartyId>org:eu:europa:as4:example:accesspoint:B</eb:PartyId><eb:Role>Receiver</eb:Role></eb:To></eb:PartyInfo><eb:CollaborationInfo><eb:AgreementRef pmode=\"03-sample-pmode\">http://agreements.europa.org/agreement</eb:AgreementRef><eb:Service type=\"org:europa:services\">getting:started</eb:Service><eb:Action>eu:sample:03</eb:Action><eb:ConversationId>1</eb:ConversationId></eb:CollaborationInfo><eb:PayloadInfo><eb:PartInfo href=\"cid:earth\"><eb:PartProperties><eb:Property name=\"CompressionType\">application/gzip</eb:Property><eb:Property name=\"MimeType\">image/jpeg</eb:Property></eb:PartProperties></eb:PartInfo><eb:PartInfo href=\"cid:xml-sample\"><eb:PartProperties><eb:Property name=\"CompressionType\">application/gzip</eb:Property><eb:Property name=\"MimeType\">application/xml</eb:Property><eb:Property name=\"Important\">Yes</eb:Property></eb:PartProperties></eb:PartInfo></eb:PayloadInfo></eb:UserMessage></eb:Messaging></s12:Header><s12:Body p2:Id=\"body-419d62e8-ea24-4c05-a40b-7a0169065b46\" xmlns:p2=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" /></s12:Envelope>");

                return doc;
            }
        }

        public class Decryption
        {
            
        }
    }
}
