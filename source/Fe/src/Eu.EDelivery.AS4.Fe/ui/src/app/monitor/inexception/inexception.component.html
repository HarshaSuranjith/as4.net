<as4-box title="Filters">
    <div content>
        <as4-filter #filter [filter]="inExceptionFilter">
            <div class="col-md-6 col-xs-12">
                <as4-input label="Id" labelSize="3" controlSize="9">
                    <input type="text" name="id" [(ngModel)]="filter.filter.id" />
                </as4-input>
                <as4-input label="Operation" labelSize="3" controlSize="9">
                    <select name="operation" [(ngModel)]="filter.filter.operation">
                        <option value="undefined">None</option>
                        <option value="0">Not applicable</option>
                        <option value="1">To be sent</option>
                        <option value="2">Sending</option>
                        <option value="3">Sent</option>
                        <option value="4">To be notified</option>
                        <option value="5">Notifying</option>
                        <option value="6">Notified</option>
                        <option value="7">To be delivered</option>
                        <option value="8">Delivering</option>
                        <option value="9">Delivered</option>
                    </select>
                </as4-input>
                <as4-input label="Exception type" labelSize="3" controlSize="9">
                    <select name="exceptiontype" [(ngModel)]="filter.filter.exceptionType">
                        <option value="undefined">None</option>
                        <option value="0">Non applicable</option>
                        <option value="1">Connection failure</option>
                        <option value="2">Value not recognized</option>
                        <option value="3">Feature not supported</option>
                        <option value="4">Value inconsistent</option>
                        <option value="5">Empty message partition channel</option>
                        <option value="6">Mime inconsistency</option>
                        <option value="7">Invalid header</option>
                        <option value="8">Processing mode mismatch</option>
                        <option value="9">External payload error</option>
                    </select>
                </as4-input>
                <as4-input label="Operation method" labelSize="3" controlSize="9">
                    <input type="text" [(ngModel)]="filter.filter.operationMethod" name="operationMethod" />
                </as4-input>
            </div>
            <div class="col-md-6 col-xs-12">
                <as4-input label="Embs ref to message id" labelSize="3" controlSize="9">
                    <input type="text" name="ebmsRefToMessageId" [(ngModel)]="filter.vebmsRefToMessageId" />
                </as4-input>
                <as4-input label="Modification time" labelSize="3" controlSize="9">
                    <div class="row">
                        <div class="col-md-6">
                            <as4-input label="From" labelSize="2" controlSize="10">
                                <input class="col-xs-10" type="text" as4-datetimepicker [(ngModel)]="filter.filter.modificationTimeFrom" />
                            </as4-input>
                        </div>
                        <div class="col-md-6">
                            <as4-input label="To" labelSize="2" controlSize="10">
                                <input type="text" as4-datetimepicker [(ngModel)]="filter.filter.modificationTimeTo" />
                            </as4-input>
                        </div>
                    </div>
                </as4-input>
                <as4-input label="Insertion time" labelSize="3" controlSize="9">
                     <div class="row">
                        <div class="col-md-6">
                            <as4-input label="From" labelSize="2" controlSize="10">
                                <input class="col-xs-10" type="text" as4-datetimepicker [(ngModel)]="filter.filter.insertionTimeFrom" />
                            </as4-input>
                        </div>
                        <div class="col-md-6">
                            <as4-input label="To" labelSize="2" controlSize="10">
                                <input type="text" as4-datetimepicker [(ngModel)]="filter.filter.insertionTimeTo" />
                            </as4-input>
                        </div>
                    </div>
                </as4-input>
                <as4-input>
                    <button type="submit" class="btn btn-default">Search</button>
                </as4-input>
            </div>
        </as4-filter>
    </div>
</as4-box>
<as4-box title="Messages in exception">
    <div content>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th></th>
                    <th sort field="id" [filter]="inExceptionFilter">Id</th>
                    <th>Operation</th>
                    <th>Operation method</th>
                    <th>Exception type</th>
                    <th>Ebms ref message to</th>
                    <th>Modification time</th>
                    <th>Insertion time</th>
                </tr>
            </thead>
            <tbody>
                <ng-container *ngFor="let message of (messages | async).messages; let i = index">
                    <tr>
                        <td><i class="fa" [class.fa-chevron-right]="message !== activeMessage" [class.fa-chevron-down]="message === activeMessage"
                                (click)="toggle(message)"></i></td>
                        <td>{{message.id}}</td>
                        <td>{{message.operationString}}</td>
                        <td>{{message.operationMethod}}</td>
                        <td>{{message.exceptionTypeString}}</td>
                        <td>{{message.ebmsRefToMessageId}}</td>
                        <td>{{message.modificationTime}}</td>
                        <td>{{message.insertionTime}}</td>
                    </tr>
                    <tr *ngIf="message === activeMessage">
                        <td colspan="10">
                            <as4-tab>
                                <div tabitem title="Exception">
                                    <template #headerExtra>
                                        <as4-clipboard [target]="exception"></as4-clipboard>
                                    </template>
                                    <div #exception>{{message.exception}}</div>
                                </div>
                            </as4-tab>
                        </td>
                    </tr>
                </ng-container>
            </tbody>
        </table>
        <as4-pager [pages]="(messages | async).pages" [pageTotal]="(messages | async).messages.length" [total]="(messages | async).total"
            [page]="(messages | async).page" (onChangePage)="filter.filter.page = $event; filter.search()"></as4-pager>
    </div>
</as4-box>